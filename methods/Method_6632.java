public String getTranslitString(String src,boolean ru,boolean onlyEnglish){
  if (src == null) {
    return null;
  }
  if (ruTranslitChars == null) {
    ruTranslitChars=new HashMap<>(33);
    ruTranslitChars.put("?","a");
    ruTranslitChars.put("?","b");
    ruTranslitChars.put("?","v");
    ruTranslitChars.put("?","g");
    ruTranslitChars.put("?","d");
    ruTranslitChars.put("?","e");
    ruTranslitChars.put("?","yo");
    ruTranslitChars.put("?","zh");
    ruTranslitChars.put("?","z");
    ruTranslitChars.put("?","i");
    ruTranslitChars.put("?","i");
    ruTranslitChars.put("?","k");
    ruTranslitChars.put("?","l");
    ruTranslitChars.put("?","m");
    ruTranslitChars.put("?","n");
    ruTranslitChars.put("?","o");
    ruTranslitChars.put("?","p");
    ruTranslitChars.put("?","r");
    ruTranslitChars.put("?","s");
    ruTranslitChars.put("?","t");
    ruTranslitChars.put("?","u");
    ruTranslitChars.put("?","f");
    ruTranslitChars.put("?","h");
    ruTranslitChars.put("?","ts");
    ruTranslitChars.put("?","ch");
    ruTranslitChars.put("?","sh");
    ruTranslitChars.put("?","sch");
    ruTranslitChars.put("?","i");
    ruTranslitChars.put("?","");
    ruTranslitChars.put("?","");
    ruTranslitChars.put("?","e");
    ruTranslitChars.put("?","yu");
    ruTranslitChars.put("?","ya");
  }
  if (translitChars == null) {
    translitChars=new HashMap<>(487);
    translitChars.put("?","c");
    translitChars.put("?","n");
    translitChars.put("?","d");
    translitChars.put("?","y");
    translitChars.put("?","o");
    translitChars.put("ø","o");
    translitChars.put("?","a");
    translitChars.put("?","h");
    translitChars.put("?","y");
    translitChars.put("?","k");
    translitChars.put("?","u");
    translitChars.put("?","aa");
    translitChars.put("?","ij");
    translitChars.put("?","l");
    translitChars.put("?","i");
    translitChars.put("?","b");
    translitChars.put("?","r");
    translitChars.put("?","e");
    translitChars.put("?","ffi");
    translitChars.put("?","o");
    translitChars.put("?","r");
    translitChars.put("?","o");
    translitChars.put("?","i");
    translitChars.put("?","p");
    translitChars.put("ı","y");
    translitChars.put("?","e");
    translitChars.put("?","o");
    translitChars.put("?","a");
    translitChars.put("?","b");
    translitChars.put("?","e");
    translitChars.put("?","c");
    translitChars.put("?","h");
    translitChars.put("?","b");
    translitChars.put("?","s");
    translitChars.put("?","d");
    translitChars.put("?","o");
    translitChars.put("?","j");
    translitChars.put("?","a");
    translitChars.put("?","y");
    translitChars.put("?","v");
    translitChars.put("?","p");
    translitChars.put("?","fi");
    translitChars.put("?","k");
    translitChars.put("?","d");
    translitChars.put("?","l");
    translitChars.put("?","e");
    translitChars.put("?","k");
    translitChars.put("?","c");
    translitChars.put("?","r");
    translitChars.put("?","hv");
    translitChars.put("?","b");
    translitChars.put("?","o");
    translitChars.put("?","ou");
    translitChars.put("?","j");
    translitChars.put("?","g");
    translitChars.put("?","n");
    translitChars.put("?","j");
    translitChars.put("?","g");
    translitChars.put("?","dz");
    translitChars.put("?","z");
    translitChars.put("?","au");
    translitChars.put("?","u");
    translitChars.put("?","g");
    translitChars.put("?","o");
    translitChars.put("?","a");
    translitChars.put("?","a");
    translitChars.put("õ","o");
    translitChars.put("?","r");
    translitChars.put("?","o");
    translitChars.put("?","a");
    translitChars.put("?","l");
    translitChars.put("?","s");
    translitChars.put("?","fl");
    translitChars.put("?","i");
    translitChars.put("?","e");
    translitChars.put("?","n");
    translitChars.put("ï","i");
    translitChars.put("ñ","n");
    translitChars.put("?","i");
    translitChars.put("?","t");
    translitChars.put("?","z");
    translitChars.put("?","y");
    translitChars.put("?","y");
    translitChars.put("?","s");
    translitChars.put("?","r");
    translitChars.put("?","g");
    translitChars.put("?","u");
    translitChars.put("?","k");
    translitChars.put("?","et");
    translitChars.put("?","i");
    translitChars.put("?","t");
    translitChars.put("?","c");
    translitChars.put("?","l");
    translitChars.put("?","av");
    translitChars.put("û","u");
    translitChars.put("æ","ae");
    translitChars.put("?","a");
    translitChars.put("?","u");
    translitChars.put("?","s");
    translitChars.put("?","r");
    translitChars.put("?","a");
    translitChars.put("?","b");
    translitChars.put("?","h");
    translitChars.put("?","s");
    translitChars.put("?","e");
    translitChars.put("?","h");
    translitChars.put("?","x");
    translitChars.put("?","k");
    translitChars.put("?","d");
    translitChars.put("?","oi");
    translitChars.put("?","p");
    translitChars.put("?","h");
    translitChars.put("?","v");
    translitChars.put("?","w");
    translitChars.put("?","n");
    translitChars.put("?","m");
    translitChars.put("?","g");
    translitChars.put("?","n");
    translitChars.put("?","p");
    translitChars.put("?","v");
    translitChars.put("?","u");
    translitChars.put("?","b");
    translitChars.put("?","p");
    translitChars.put("å","a");
    translitChars.put("?","c");
    translitChars.put("?","o");
    translitChars.put("?","a");
    translitChars.put("ƒ","f");
    translitChars.put("?","ae");
    translitChars.put("?","vy");
    translitChars.put("?","ff");
    translitChars.put("?","r");
    translitChars.put("ô","o");
    translitChars.put("?","o");
    translitChars.put("?","u");
    translitChars.put("?","z");
    translitChars.put("?","f");
    translitChars.put("?","d");
    translitChars.put("?","e");
    translitChars.put("?","u");
    translitChars.put("?","n");
    translitChars.put("?","q");
    translitChars.put("?","a");
    translitChars.put("?","k");
    translitChars.put("?","i");
    translitChars.put("?","u");
    translitChars.put("?","t");
    translitChars.put("?","r");
    translitChars.put("?","k");
    translitChars.put("?","t");
    translitChars.put("?","q");
    translitChars.put("?","a");
    translitChars.put("?","j");
    translitChars.put("?","l");
    translitChars.put("?","f");
    translitChars.put("?","s");
    translitChars.put("?","r");
    translitChars.put("?","v");
    translitChars.put("?","o");
    translitChars.put("?","c");
    translitChars.put("?","u");
    translitChars.put("?","z");
    translitChars.put("?","u");
    translitChars.put("?","n");
    translitChars.put("?","w");
    translitChars.put("?","a");
    translitChars.put("?","lj");
    translitChars.put("?","b");
    translitChars.put("?","r");
    translitChars.put("ò","o");
    translitChars.put("?","w");
    translitChars.put("?","d");
    translitChars.put("?","ay");
    translitChars.put("?","u");
    translitChars.put("?","b");
    translitChars.put("?","u");
    translitChars.put("?","e");
    translitChars.put("?","a");
    translitChars.put("?","h");
    translitChars.put("?","o");
    translitChars.put("?","u");
    translitChars.put("?","y");
    translitChars.put("?","o");
    translitChars.put("?","e");
    translitChars.put("?","e");
    translitChars.put("?","i");
    translitChars.put("?","e");
    translitChars.put("?","t");
    translitChars.put("?","d");
    translitChars.put("?","h");
    translitChars.put("?","s");
    translitChars.put("ë","e");
    translitChars.put("?","m");
    translitChars.put("ö","o");
    translitChars.put("é","e");
    translitChars.put("?","i");
    translitChars.put("?","d");
    translitChars.put("?","m");
    translitChars.put("?","y");
    translitChars.put("?","w");
    translitChars.put("?","e");
    translitChars.put("?","u");
    translitChars.put("?","z");
    translitChars.put("?","j");
    translitChars.put("?","d");
    translitChars.put("?","u");
    translitChars.put("?","j");
    translitChars.put("ê","e");
    translitChars.put("?","u");
    translitChars.put("?","g");
    translitChars.put("?","r");
    translitChars.put("?","n");
    translitChars.put("?","e");
    translitChars.put("?","s");
    translitChars.put("?","d");
    translitChars.put("?","k");
    translitChars.put("?","ae");
    translitChars.put("?","e");
    translitChars.put("?","o");
    translitChars.put("?","m");
    translitChars.put("?","f");
    translitChars.put("?","a");
    translitChars.put("?","oo");
    translitChars.put("?","m");
    translitChars.put("?","p");
    translitChars.put("?","u");
    translitChars.put("?","k");
    translitChars.put("?","h");
    translitChars.put("?","t");
    translitChars.put("?","p");
    translitChars.put("?","m");
    translitChars.put("á","a");
    translitChars.put("?","n");
    translitChars.put("?","v");
    translitChars.put("è","e");
    translitChars.put("?","z");
    translitChars.put("?","d");
    translitChars.put("?","p");
    translitChars.put("?","l");
    translitChars.put("?","z");
    translitChars.put("?","m");
    translitChars.put("?","r");
    translitChars.put("?","v");
    translitChars.put("?","u");
    translitChars.put("ß","ss");
    translitChars.put("?","h");
    translitChars.put("?","t");
    translitChars.put("?","z");
    translitChars.put("?","r");
    translitChars.put("?","n");
    translitChars.put("à","a");
    translitChars.put("?","y");
    translitChars.put("?","y");
    translitChars.put("?","oe");
    translitChars.put("?","x");
    translitChars.put("?","u");
    translitChars.put("?","j");
    translitChars.put("?","a");
    translitChars.put("?","z");
    translitChars.put("?","s");
    translitChars.put("?","i");
    translitChars.put("?","ao");
    translitChars.put("?","z");
    translitChars.put("ÿ","y");
    translitChars.put("?","e");
    translitChars.put("?","o");
    translitChars.put("?","d");
    translitChars.put("?","l");
    translitChars.put("ù","u");
    translitChars.put("?","a");
    translitChars.put("?","b");
    translitChars.put("?","u");
    translitChars.put("?","a");
    translitChars.put("?","t");
    translitChars.put("?","y");
    translitChars.put("?","t");
    translitChars.put("?","l");
    translitChars.put("?","j");
    translitChars.put("?","z");
    translitChars.put("?","h");
    translitChars.put("?","w");
    translitChars.put("?","k");
    translitChars.put("?","o");
    translitChars.put("î","i");
    translitChars.put("?","g");
    translitChars.put("?","e");
    translitChars.put("?","a");
    translitChars.put("?","a");
    translitChars.put("?","q");
    translitChars.put("?","t");
    translitChars.put("?","um");
    translitChars.put("?","c");
    translitChars.put("?","x");
    translitChars.put("?","u");
    translitChars.put("?","i");
    translitChars.put("?","r");
    translitChars.put("?","s");
    translitChars.put("?","o");
    translitChars.put("?","y");
    translitChars.put("?","s");
    translitChars.put("?","nj");
    translitChars.put("?","a");
    translitChars.put("?","t");
    translitChars.put("?","l");
    translitChars.put("","z");
    translitChars.put("?","th");
    translitChars.put("?","d");
    translitChars.put("?","s");
    translitChars.put("š","s");
    translitChars.put("?","u");
    translitChars.put("?","e");
    translitChars.put("?","s");
    translitChars.put("?","e");
    translitChars.put("?","u");
    translitChars.put("?","o");
    translitChars.put("?","s");
    translitChars.put("?","v");
    translitChars.put("?","is");
    translitChars.put("?","o");
    translitChars.put("?","e");
    translitChars.put("?","a");
    translitChars.put("?","ffl");
    translitChars.put("?","o");
    translitChars.put("?","i");
    translitChars.put("?","ue");
    translitChars.put("?","d");
    translitChars.put("?","z");
    translitChars.put("?","w");
    translitChars.put("?","a");
    translitChars.put("?","t");
    translitChars.put("?","g");
    translitChars.put("?","n");
    translitChars.put("?","g");
    translitChars.put("?","u");
    translitChars.put("?","a");
    translitChars.put("?","n");
    translitChars.put("?","i");
    translitChars.put("?","r");
    translitChars.put("?","a");
    translitChars.put("?","s");
    translitChars.put("?","o");
    translitChars.put("?","r");
    translitChars.put("?","t");
    translitChars.put("?","i");
    translitChars.put("?","ae");
    translitChars.put("?","v");
    translitChars.put("?","oe");
    translitChars.put("?","m");
    translitChars.put("?","z");
    translitChars.put("?","e");
    translitChars.put("?","av");
    translitChars.put("?","o");
    translitChars.put("?","e");
    translitChars.put("?","l");
    translitChars.put("?","i");
    translitChars.put("?","d");
    translitChars.put("?","st");
    translitChars.put("?","l");
    translitChars.put("?","r");
    translitChars.put("?","ou");
    translitChars.put("?","t");
    translitChars.put("?","a");
    translitChars.put("?","e");
    translitChars.put("?","o");
    translitChars.put("ç","c");
    translitChars.put("?","s");
    translitChars.put("?","a");
    translitChars.put("?","u");
    translitChars.put("?","a");
    translitChars.put("?","g");
    translitChars.put("?","k");
    translitChars.put("?","z");
    translitChars.put("?","s");
    translitChars.put("?","e");
    translitChars.put("?","g");
    translitChars.put("?","l");
    translitChars.put("?","f");
    translitChars.put("?","x");
    translitChars.put("?","o");
    translitChars.put("?","e");
    translitChars.put("?","o");
    translitChars.put("?","t");
    translitChars.put("?","o");
    translitChars.put("i?","i");
    translitChars.put("?","n");
    translitChars.put("?","c");
    translitChars.put("?","g");
    translitChars.put("?","w");
    translitChars.put("?","d");
    translitChars.put("?","l");
    translitChars.put("œ","oe");
    translitChars.put("?","r");
    translitChars.put("?","l");
    translitChars.put("?","r");
    translitChars.put("?","o");
    translitChars.put("?","n");
    translitChars.put("?","ae");
    translitChars.put("?","l");
    translitChars.put("ä","a");
    translitChars.put("?","p");
    translitChars.put("?","o");
    translitChars.put("?","i");
    translitChars.put("?","r");
    translitChars.put("?","dz");
    translitChars.put("?","g");
    translitChars.put("?","u");
    translitChars.put("?","o");
    translitChars.put("?","l");
    translitChars.put("?","w");
    translitChars.put("?","t");
    translitChars.put("?","n");
    translitChars.put("?","r");
    translitChars.put("?","a");
    translitChars.put("ü","u");
    translitChars.put("?","l");
    translitChars.put("?","o");
    translitChars.put("?","o");
    translitChars.put("?","b");
    translitChars.put("?","r");
    translitChars.put("?","r");
    translitChars.put("?","y");
    translitChars.put("?","f");
    translitChars.put("?","h");
    translitChars.put("?","o");
    translitChars.put("ú","u");
    translitChars.put("?","r");
    translitChars.put("?","h");
    translitChars.put("ó","o");
    translitChars.put("?","u");
    translitChars.put("?","o");
    translitChars.put("?","p");
    translitChars.put("?","i");
    translitChars.put("?","u");
    translitChars.put("ã","a");
    translitChars.put("?","i");
    translitChars.put("?","t");
    translitChars.put("?","e");
    translitChars.put("?","u");
    translitChars.put("í","i");
    translitChars.put("?","o");
    translitChars.put("?","r");
    translitChars.put("?","g");
    translitChars.put("?","r");
    translitChars.put("?","h");
    translitChars.put("?","u");
    translitChars.put("?","o");
    translitChars.put("?","l");
    translitChars.put("?","h");
    translitChars.put("?","t");
    translitChars.put("?","n");
    translitChars.put("?","e");
    translitChars.put("ì","i");
    translitChars.put("?","w");
    translitChars.put("?","e");
    translitChars.put("?","e");
    translitChars.put("?","l");
    translitChars.put("?","o");
    translitChars.put("?","l");
    translitChars.put("?","y");
    translitChars.put("?","j");
    translitChars.put("?","k");
    translitChars.put("?","v");
    translitChars.put("?","e");
    translitChars.put("â","a");
    translitChars.put("?","s");
    translitChars.put("?","r");
    translitChars.put("?","v");
    translitChars.put("?","a");
    translitChars.put("?","c");
    translitChars.put("?","e");
    translitChars.put("?","m");
    translitChars.put("?","w");
    translitChars.put("?","o");
    translitChars.put("?","c");
    translitChars.put("?","g");
    translitChars.put("?","c");
    translitChars.put("?","o");
    translitChars.put("?","k");
    translitChars.put("?","q");
    translitChars.put("?","o");
    translitChars.put("?","s");
    translitChars.put("?","o");
    translitChars.put("?","h");
    translitChars.put("?","o");
    translitChars.put("?","tz");
    translitChars.put("?","e");
  }
  StringBuilder dst=new StringBuilder(src.length());
  int len=src.length();
  boolean upperCase=false;
  for (int a=0; a < len; a++) {
    String ch=src.substring(a,a + 1);
    if (onlyEnglish) {
      String lower=ch.toLowerCase();
      upperCase=!ch.equals(lower);
      ch=lower;
    }
    String tch=translitChars.get(ch);
    if (tch == null && ru) {
      tch=ruTranslitChars.get(ch);
    }
    if (tch != null) {
      if (onlyEnglish && upperCase) {
        if (tch.length() > 1) {
          tch=tch.substring(0,1).toUpperCase() + tch.substring(1);
        }
 else {
          tch=tch.toUpperCase();
        }
      }
      dst.append(tch);
    }
 else {
      if (onlyEnglish) {
        char c=ch.charAt(0);
        if (((c < 'a' || c > 'z') || (c < '0' || c > '9')) && c != ' ' && c != '\'' && c != ',' && c != '.' && c != '&' && c != '-' && c != '/') {
          return null;
        }
        if (upperCase) {
          ch=ch.toUpperCase();
        }
      }
      dst.append(ch);
    }
  }
  return dst.toString();
}
